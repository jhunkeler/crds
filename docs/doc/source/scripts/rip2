#! /usr/bin/env pysh
#-*-python-*-

usage("""<inpat> <outpat> <files...>

matches Python re <inpat> against all the lines in each of <files...>

for each matching line,  do re sub using <outpat> and print the result.
""", 3)

inpat = re.compile(sys.argv.pop(1))
outpat = sys.argv.pop(1)

for f in sys.argv[1:]:
    for line in open(f).readlines():
        match = inpat.search(line)
        if match:
            sys.stdout.write( inpat.sub(outpat, line) )
        else:
            sys.stdout.write(line)

