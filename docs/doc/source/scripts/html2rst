#! /usr/bin/env pysh
#-*-python-*-

patterns = {
    "<a>"  : ('(.*)<a\s+href=["](.*)["]>(.*)</a>(.*)',  
              '\\1 `\\3 <\\2>`_ \\4'),	
    "<h1>" : ('(.*)<h1[^>]*>(.*)</h1>(.*)', '\\1 \\2 </h1> \\3'),
    "<h2>" : ('(.*)<h2[^>]*>(.*)</h2>(.*)', '\\1 \\2 </h2> \\3'),
    "<h3>" : ('(.*)<h3[^>]*>(.*)</h3>(.*)', '\\1 \\2 </h3> \\3'),
    "<h4>" : ('(.*)<h4[^>]*>(.*)</h4>(.*)', '\\1 \\2 </h4> \\3'),
    "<i>" : ('(.*)<i>(.*)', '\\1*\\2'),
    "</i>" : ('(.*)</i>(.*)', '\\1*\\2'),
    "<b>" : ('(.*)<b>(.*)', '\\1**\\2'),
    "</b>" : ('(.*)</b>(.*)', '\\1**\\2'),

    "<strong>" : ('(.*)<strong>(.*)', '\\1**\\2'),
    "</strong>" : ('(.*)</strong>(.*)', '\\1**\\2'),

    "<td>" : ('(.*)<td[^>]*>(.*)', '\\1 \\2'),
    "</td>" : ('(.*)</td>(.*)', '\\1 \\2'),

    "<p>" : ('(.*)<p[^>]*>(.*)', '\\1 \\2'),
    "</p>" : ('(.*)</p[^>]*>(.*)', '\\1 \\2'),

    "<table>" : ('(.*)<table[^>]*>(.*)', 
                 '\\1 \\2 \n========================='),
    "</table>" : ('(.*)</table[^>]*>(.*)', 
                  '\\1 \\2 \n========================='),
 
    "<img>" : ('<img src="(.*)"\s+alt="(.*)">',
               '.. image:: images/\\1\n    :alt: \\2\n'),

    "&ldquot;" : ('(.*)&ldquot;(.*)', '\\1"\\2'),
    "&rdquot;" : ('(.*)&rdquot;(.*)', '\\1"\\2'),

    "&lsquot;" : ('(.*)&lsquot;(.*)', '\\1"\\2'),
    "&rsquot;" : ('(.*)&rsquot;(.*)', '\\1"\\2'),

    "&quot;"   : ('(.*)&quot;(.*)', '\\1"\\2'),

    "&gt;"   : ('(.*)&gt;(.*)', '\\1>\\2'),
    "&lt;"   : ('(.*)&lt;(.*)', '\\1<\\2'),

    "<li>"     : ('(.*)<li>(.*)', '- \\1 \\2'),
    "</li>"     : ('(.*)</li>(.*)', ' \\1\\2'),

    "<ul>"     :  ('(.*)<ul>(.*)', ' \\1\\2'),
    "</ul>"    :  ('(.*)</ul>(.*)', ' \\1\\2'),
    "<ol>"     :  ('(.*)<ol>(.*)', ' \\1\\2'),
    "</ol>"     :  ('(.*)</ol>(.*)', ' \\1\\2'),
}

% cp $1 html2rst.tmp
for p in patterns:
    print >>sys.stderr, "handling", p
    frm, to = patterns[p]
    % rip2 '${frm}'  '${to}'  html2rst.tmp  >html2rst.out
    % mv html2rst.out html2rst.tmp

% mv html2rst.tmp $1

